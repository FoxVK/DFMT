% Nejprve uvedeme tridu dokumentu s volbami
\documentclass[czech,master,public,dept460,male,cpdeclaration]{diploma}	% jednostranny dokument

\usepackage[utf8]{inputenc}
\inputencoding{utf8}
\usepackage[czech]{babel}

\usepackage{subfig}		% makra pro "podobrazky" a "podtabulky"
\usepackage{tikz}		% makra pro kresleni

\usepackage{makecell}

\usepackage{pdflscape}

\usepackage{placeins}


\newcommand{\iic}{I\textsuperscript{2}C }
\newcommand{\iis}{I\textsuperscript{2}S }
\newcommand{\eeprom}{E\textsuperscript{2}PROM}

\newcommand{\VID}{0x04D8}
\newcommand{\PID}{0xF32C}

%\widowpenalty10000
%\clubpenalty10000


% Zadame pozadovane vstupy pro generovani titulnich stran.
\ThesisAuthor{Bc. Pavel Kovář}

% U bakalarske praxe neni nutne nazev zadavat
\CzechThesisTitle{Modul USB FM rádia}

% U bakalarske praxe neni nutne anglicky nazev zadavat
\EnglishThesisTitle{USB FM Radio Modul}

\SubmissionDate{29. dubna 2016}

%\PrintPublicationAgreement{true}

\Thanks{Rád bych na tomto místě poděkoval mému vedoucímu panu Ing. Davidu Seidlovi, Ph.D. za cenné rady a trpělivost.}

\CzechAbstract{Tato práce popisuje návrh USB FM přijímače se dvěma tunery. Jeden tuner slouží pro přehrávání zvuku a~druhý pro vyhledávání dalších stanic. Přijímač je v~systému reprezentován jako USB zvuková karta.\\ 
Příjem je realizován dvojicí integrovaných obvodů Si4735-DU. Tyto jsou přes \iis a \iic  spojeny s~MCU PIC32MX250F128B, který přes USB zajišťuje komunikaci s počítačem. V rámci firmware MCU je, po neúspěchu s Microchip harmony frameworkem, napsán vlastní USB stack.\\
Knihovna je napsána v jazyku~C s~využitím knihovny libusb. Poskytuje funkce pro tři úrovně přístupu k~tunerům.\\
Demonstrační aplikace je ve formě grafického uživatelského rozhraní, napsaná  v~C++ s využitím QT frameworku.\\
Vše je funkční pod OS Linux i~Windows.}

\CzechKeywords{FM rádio, USB, RDS, QT, libusb, PIC}

\EnglishAbstract{This work describes design of USB FM radio receiver with two tuners. One tuner is for radio playback, second one seeks new stations. In computer, device acts as sound card.\\
Receiving is done by couple of Si4735-DU integrated circuits, which are connected to MCU via \iic and \iis. MCU forwards data over USB to computer and back. Use of Microchip harmony framework was not successful so in firmware is USB stack written from scratch.\\
Library is written in C with use of libusb library. There are three levels of functions to access tuners.\\
Demo application has graphical user interface and is written in C++ in QT framework.\\
All works under Linux and Windows.}

\EnglishKeywords{FM radio receiver, USB, RDS, QT, libusb, PIC}

% Pridame pouzivane zkratky (pokud nejake pouzivame).
\AddAcronym{AM}{Amlitudová Modulace (Rozhlasové vysílání v pásmu dlouhých vln)}
\AddAcronym{CD}{Compact disc}
\AddAcronym{DAB}{Digital Audio Broadcasting (Digitální pozemní rozhlasové vysílání)}
\AddAcronym{DIP}{Dual Inline Package}
\AddAcronym{FM}{Rozhlasové vysílání v pásmu velmi krátkých vln}
\AddAcronym{HTML}{Hypertext Markup Language}
\AddAcronym{\iic}{Inter-Integrated Circuit}
\AddAcronym{\iis}{Integrated Interchip Sound}
\AddAcronym{LW}{Long Waves (Rozhlasové vysílání v pásmu dlouhých vln)}
\AddAcronym{MCU}{Microcontroller unit}
\AddAcronym{OS}{Operační systém}
\AddAcronym{PCM}{Pulse-code modulation}
\AddAcronym{RDS}{Radio Data System}
\AddAcronym{SPI}{Serial Peripheral Interface}
\AddAcronym{SSOP}{Shrink Small-Outline Package}
\AddAcronym{SW}{Short Waves (Rozhlasové vysílání v pásmu krátkých vln)}
\AddAcronym{USB}{Universal Serial Bus}
\AddAcronym{UTF-16}{Způsob kódování znaků ISO 10646/Unicode}
\AddAcronym{QFN}{Quad Flat No-leads package}



% Zadame cestu a jmeno souboru ci nekolika souboru s digitalizovanou podobou zadani prace
% Pri sazbe se pak hledaji soubory Figures/Zadani1.jpg, Figures/Zadani2.jpg atd.
% Do diplomove prace se postupne vlozi vsechny existujici soubory Figures/ZadaniXXX.jpg
% Pokud toto makro zapoznamkujeme sazi se stranka s upozornenim
\ThesisAssignmentImagePath{figures/zadani}

% Zadame soubor s digitalizovanou podobou prohlaseni
% Pokud toto makro zapoznamkujeme sazi se cisty text prohlaseni
%\DeclarationImageFile{figures/Prohlaseni.jpg}



% Zacatek dokumentu
\begin{document}

% Nechame vysazet titulni strany.
\MakeTitlePages


\input{chapters/uvod.tex}

\input{chapters/vyber.tex}
\input{chapters/tuner.tex}
\input{chapters/usb.tex}
\input{chapters/knihovna.tex}

\input{chapters/zaver.tex}




\begin{thebibliography}{99}


\bibitem{usb-complete} AXELSON, Jan. 
\textit{USB complete: the developer's guide.} 4th ed. Madison, WI: Lakeview Research, 2009, xxiii, 504 p. ISBN 1-931448-08-6.

%usb reference
\bibitem{usb-spec} Compaq, Hewlett-Packard, Intel, Lucent, Microsoft, NEC, Philips. 
\textit{Universal Serial Bus Specification: Revision 2.0} [online] 2000-04-27 [2015-12-26]
\url{http://www.usb.org/developers/docs/usb20_docs/usb_20_0702115.zip}

%usb audio 1.0
\bibitem{usb-audio} Gal Ashour, Billy Brackenridge, Oren Tirosh, Altec Lansing, Craig Todd, Remy Zimmermann, Geert Knapen. 
\textit{Universal Serial Bus Device Class Definition for Audio Devices: Release 1.0} [online] 1998-03-18 [2015-12-26]
\url{http://www.usb.org/developers/docs/devclass_docs/audio10.pdf}

%usb audio formats 
\bibitem{usb-audio-formats} Gal Ashour, Billy Brackenridge, Oren Tirosh, Altec Lansing, Craig Todd, Remy Zimmermann, Geert Knapen. 
\textit{Universal Serial Bus Device Class Definition for Audio Data Formats} [online] 1998-03-18 [2016-02-20]
\url{http://www.usb.org/developers/docs/devclass_docs/frmts10.pdf}

%usb lang codes
\bibitem{usb-lang}  USB Implementers’ Forum. 
\textit{Universal Serial Bus Language Identifiers (LANGIDs): Version 1.0} [online] 2000-03-26 [2016-02-09]
\url{http://www.usb.org/developers/docs/USB_LANGIDs.pdf}

\bibitem{tuner-datasheet} Silicon Laboratories,
\textit{Si4730/Si4731/Si4734/Si4735-D60 Broadcast AM/FM/SW/LW Radio Receiver: Rev. 1.2 8/13} [online] 2013-08-08 [2015-12-26] \url{https://www.silabs.com/Support\%20Documents/TechnicalDocs/Si4730-31-34-35-D60.pdf}

\bibitem{tuner-programing} Silicon Laboratories,
\textit{AN332: Si47xx Programming Guide: Rev. 1.0 9/14 } [online] 2014-09-10 [2015-12-26] \url{http://www.silabs.com/Support\%20Documents/TechnicalDocs/AN332.pdf}

%microchip pic
\bibitem{pic} Microchip Technology Inc.
\textit{PIC32MX1XX/2XX Family Data Sheet: Revision H} [online] 2015-07-29 [2015-12-26]
\url{http://ww1.microchip.com/downloads/en/DeviceDoc/60001168H.pdf}

%microchip i2s
%\bibitem{pic-iis} Microchip Technology Inc.
%\textit{PIC32 Family Reference Manual, Sect. 23 Serial Peripheral Interface} [online] 2011-10-11 [2015-12-26]
%\url{http://ww1.microchip.com/downloads/en/DeviceDoc/61106G.pdf}

%microchip i2c
\bibitem{pic-iic} Microchihttp://ww1.microchip.com/downloads/en/DeviceDoc/61116F.pdp Technology Inc.
\textit{PIC32 Family Reference Manual,  Sect 24. Inter-Integrated Circui} [online] 2013-03 [2015-12-26]
\url{http://ww1.microchip.com/downloads/en/DeviceDoc/61116F.pdf}

%microchip dma
%\bibitem{pic-dma} Microchip Technology Inc.
%\textit{PIC32 Family Reference Manual, Sect. 31 DMA Controller} [online] 2013-11-15 [2015-12-26]
%\url{http://ww1.microchip.com/downloads/en/DeviceDoc/60001117H.pdf}

%microchip usb
\bibitem{pic-usb} Microchip Technology Inc.
\textit{PIC32 Family Reference Manual, Sect. 27 USB On-The-Go} [online] 2011-04-13 [2015-12-26]
\url{http://ww1.microchip.com/downloads/en/DeviceDoc/61126F.pdf}

%microchip errata
\bibitem{pic-errata} Microchip Technology Inc.
\textit{PIC32MX1XX/2XX 28/36/44-pin Family Silicon Errata and Data Sheet Clarification} [online] 2015-07-29 [2015-12-26]
\url{http://ww1.microchip.com/downloads/en/DeviceDoc/80000531G.pdf}

%microchip harmony reference
\bibitem{harmony} Microchip Technology Inc.
\textit{MPLAB Harmony USB Libraries Help} [online] 2012-11-15 [2015-12-26]
\url{http://ww1.microchip.com/downloads/en/DeviceDoc/MPLAB\%20Harmony\%20USB\%20Libraries\%20\%28v1.06.02\%29.pdf}

\bibitem{tas}
\textit{TAS1020B USB Streaming Controller} [online] 2011-05 [2015-12-29]
\url{http://www.ti.com/lit/ds/symlink/tas1020b.pdf} 

\bibitem{le} STMicroelectronics
\textit{Very low-dropout voltage regulator with inhibit function} [online] 03-2014 [2016-01-09]
\url{http://www.st.com/st-web-ui/static/active/en/resource/technical/document/datasheet/CD00000545.pdf}

\bibitem{usb-vid} USB.org
\textit{Getting a Vendor ID} [online] [2016-01-16]
\url{http://www.usb.org/developers/vendor/}

\bibitem{iis} Philips Semiconductors
\textit{\iis bus specification} [online] 1996-06-05 [2016-02-27]
\url{http://www.st.com/st-web-ui/static/active/en/resource/technical/document/datasheet/CD00000545.pdf}

\bibitem{rds} EN 50067
\textit{Specification of the radio data system (RDS) for VHF/FM sound broadcasting in the frequency range from 87,5 to 108,0 MHz} CELNEC 04-1998 [2016-04-01]

\bibitem{libwdi} Pete Batard
\textit{libwdi: A Windows Driver Installation library for USB devices} [online] 2016-01-22 [2016-04-25]
\url{https://github.com/pbatard/libwdi#libwdi-a-windows-driver-installation-library-for-usb-devices}

\bibitem{zadig} Pete Batard
\textit{Zadig} [online] 2014-11-21 [2016-04-25]
\url{https://github.com/pbatard/libwdi/wiki/Zadig}

\bibitem{wcid} Pete Batard
\textit{WCID Devices} [online] 2014-11-21 [2016-04-25]
\url{https://github.com/pbatard/libwdi/wiki/WCID-Devices}

\end{thebibliography}




\appendix

\section{Adresářová struktura  přiloženého CD}
\label{sec:ap-cd}

\begin{itemize}
\item \textbf{diploma.pdf}: Tento text.

\item \textbf{firmware}: Projekt pro vývojové prostředí MplabX s firmwarem pro MCU.
	\begin{itemize}
	\item \textbf{dist/default/production/}: Přeložený souboru s firmwarem pro MCU.
	\end{itemize}

\item \textbf{software}: Mutiprojekt s knihovnou a demonstrační aplikací pro vývojové prostředí QT~Creator.
	\begin{itemize}
	\item \textbf{bin}:
		\begin{itemize}
		\item \textbf{win32}: 32-bitová verze knihovny a demonstrační aplikace pro OS Windows.
		\item \textbf{linuxX86\_64}: 64-bitová verze knihovny a demonstrační aplikace pro OS Linux.
		\end{itemize}
	\item \textbf{driver}: Instalátor ovladače pro OS Windows.
	\item \textbf{dfmtgui}: Projekt s demonstrační aplikací.
	\item \textbf{libdfmt}: Projekt s knihovnou.
	\begin{itemize}
		\item \textbf{doc}: Vygenerovaná dokumentace knihovny.
		\end{itemize}
	\end{itemize}
	
\item \textbf{hardware}:
	\begin{itemize}
	\item \textbf{exports}: Schéma ve formátu pdf a soubory pro výrobu desky plošných spojů.
	\item \textbf{kicad}: Projekt se schématem a deskou plošných spojů pro aplikaci KiCad.
	\end{itemize}



\end{itemize}

%\begin{landscape}

\section{Schéma zapojení modulu}
\label{sec:ap-schema}
%Na štorc
%\InsertFigure{figures/dfmt.eps}{50mm}{Schéma zapojení modulu.}{fig:schema}


\begin{center}
 \includegraphics[scale=0.72]{figures/dfmt.eps}
\end{center}
 
\section{Rozpiska součástek}
\label{sec:ap-bom}
\begin{center}
\begin{tabular}{|l|r|r|r|l|}

\hline
Označení	& Název &	Počet	&	Pouzdro	&	Parametry\\
\hline
\makecell[l]{C1, C7, C9, C12,\\C15, C16}	&	Kondenzátor	&	6	&	1206	&	100 nF 5 \% X7R  50 V\\
\hline
C2, C4	&	Kondenzátor	&	2	&	1206	& 1 nF 5 \% X7R  50 V\\
\hline
C3, C5	&	Kondenzátor	&	2	&	1207	&	470 nF 5 \% X7R  50 V\\
\hline
C6, C8	&	Kondenzátor	&	2	&	1206	&	22 nF 5 \% X7R  50 V\\
\hline
C10, C11	&	Kondenzátor	&	2	&	1206	&	18 pF 5 \% X7R  50 V\\
\hline
C13, C14	&	Kondenzátor	&	2	&	B	&	2,2 $\mu$F 10 \% Tantal 16V \\
\hline
C17	&	Kondenzátor	&	1	&	B	&	10 $\mu$F 10 \% Tantal 16V \\
\hline
IC1, IC2	&	IO	&	2	&	SSOP24	&	SI4735-D60\\
\hline
IC3	&	IO	&	1	&	SO 8	&	LE33-SMT\\
\hline
L1	&	Tlumivka	&	1	&	1210	&	10 $\mu$H 10 \% 180 mA 1,6 $\Omega$\\
\hline
MCU1	&	IO	&	1	&	DIP28	&	PIC32MX220F032B\\
\hline
MCU1	&	Patice	&	1	&	DIP28	&	\\
\hline
P4	&	Konektor	&	1	&		&	USB B zásuvka  MOLEX 670688000 \\
\hline
R1, R4	&	Rezistor	&	2	&	1206	&	560 $\Omega$ 5 \%\\
\hline
R2, R3, R5, R6	&	Rezistor	&	4	&	1206	&	2,2 k$\Omega$ 5 \%\\
\hline
R7, R8, R9	&	Rezistor	&	3	&	1206	&	4,7 k$\Omega$ 5 \%\\
\hline
SW1, SW2	&	Tlačítko	&	2	&		&	TACT 613 N (neosazeno)\\
\hline
Y1	&	Krystal	&	1	&		&	8 MHz 30 ppm HC49SM 18 pF\\
\hline
-	&	Anténa &	1	&	& Vodič	38 cm AWG24\\
\hline

\end{tabular} 
\end{center}
%\end{landscape}

%\clearpage

%\InsertFigure{figures/Graf}{0.7\textwidth}{Nějaký graf}{fig:SampleGraph}

\section{Fotografie osazené desky plošných spojů}
\label{sec:ap-pcb}

\subsection*{Horní strana:}
\begin{center}
 \includegraphics[scale=1]{figures/pcb-top.jpg}
\end{center}

\subsection*{Spodní strana:}
\begin{center} 
 \includegraphics[scale=1]{figures/pcb-bot.jpg}
\end{center}


\end{document}
